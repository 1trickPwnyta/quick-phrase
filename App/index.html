<!DOCTYPE html>
<html lang="en-us">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1, maximum-scale=1, user-scalable=0" />
		
		<!-- Style for dialog boxes -->
		<link href="style/dialog.css" rel="stylesheet" />
		
		<!-- Main style -->
		<link href="style/main.css" type="text/css" rel="stylesheet" />
		
		<!-- Theme style -->
		<link href="style/theme_light.css" type="text/css" rel="stylesheet" />
		
		<!-- Phonegap specific functions -->
		<script type="text/javascript" src="phonegap.js"></script>
		
		<!-- AJAX functions -->
		<script src="scripts/ajax.js"></script>
		
		<!-- Dialog box functions -->
		<script src="scripts/dialog.js"></script>
		
		<!-- Main JavaScript files -->
		<script src="scripts/config.js"></script>
		<script src="scripts/definitions.js"></script>
		<script src="scripts/strings.js"></script>
		<script src="scripts/helper.js"></script>
		<script src="scripts/userInterface.js"></script>
		<script src="scripts/menu.js"></script>
		<script src="scripts/webService.js"></script>
		<script src="scripts/database.js"></script>
		<script src="scripts/main.js"></script>
		
		<script>
			window.onload = function() {
				if (PHONEGAP) {
					// Set the deviceready callback
					document.addEventListener("deviceready", onDeviceReady, false);
				} else
					// Just call the deviceready callback directly
					onDeviceReady();
			};
			
			function onDeviceReady() {
				// Hide the splash screen and load the main screen after one second
				window.setTimeout(function() {
					document.getElementById("splashscreen").className = "hidden";
				}, 1000);
				
				submitUsageClick("/app/open");
				
				if (PHONEGAP) {
					// Set the Android back button action
					document.addEventListener("backbutton", backButtonClick, false);
					
					// Initialize the local database
					db = window.sqlitePlugin.openDatabase({name: DB_NAME});
					db.transaction(function(tx) {
						tx.executeSql("CREATE TABLE IF NOT EXISTS tag (id integer, category_id integer, tag text, difficulty_rating integer, edgy integer)");
						tx.executeSql("CREATE TABLE IF NOT EXISTS difficulty_level (id integer, name text, max_rating integer)");
						tx.executeSql("CREATE TABLE IF NOT EXISTS category (id integer, name text)");
					});
					
					// Hide the edgy option in the Google Play edition
					if (APP_GOOGLEPLAY_EDITION) {
						var menuItemEdgy = document.getElementById("menuItemEdgy");
						menuItemEdgy.parentNode.removeChild(menuItemEdgy);
					}
					
					// Workaround for lack of CSS "vw" support in Android 4.3-
					if (parseFloat(device.version) < 4.39) {
						var viewport = function() {
							var e = window, a = 'inner';
							if (!('innerWidth' in window )) {
								a = 'client';
								e = document.documentElement || document.body;
							}
							return { width : e[ a+'Width' ] , height : e[ a+'Height' ] };
						}
						var vw = (viewport().width/100);
						document.body.style.fontSize = vw*5 + 'px';
					}
				}
				
				// Load all the game data
				showLoadingScreen();
				loadCategories();
				loadDifficulties();
				loadStatsFromWebService();
				loadSettings(function() {
					applyTheme();
					loadTags(true, showReadyScreen);
					resetScores();
					loadScores();
				});
			}
		</script>
	</head>
	<body>
		<!-- Shows the splash screen image over the whole screen -->
		<img id="splashscreen" class="visible" src="images/splashscreen.png" />
	
		<!-- Fades the background logo into the theme's background -->
		<div id="backgroundFader"></div>
		
		<!-- Shows a confetti animation when a winner is declared -->
		<div id="confetti"></div>
		
		<div id="main">
			<!-- App menu bar -->
			<header>
				<a id="menuButton" class="header-button" href="#" onclick="menuButtonClick(); return false;">
					<img id="menuButtonIcon" class="header-button-icon" src="images/menu.png" alt="Menu" />
				</a>
				<a id="helpButton" class="header-button" href="#" onclick="helpButtonClick(); return false;">
					<img id="helpButtonIcon" class="header-button-icon" src="images/help.png" alt="Help" />
				</a>
				<a id="usedTagsButton" class="header-button" href="#" onclick="usedTagsButtonClick(); return false;">
					<img id="usedTagsButtonIcon" class="header-button-icon" src="images/usedTags.png" alt="List" />
				</a>
				<span id="app-name">
					<!-- Display the app name -->
					<script>document.write(APP_NAME);</script>
				</span>
			</header>
			
			<!-- Holds the score buttons -->
			<div id="scores"></div>
			
			<!-- Holds the current tag, or game status messages -->
			<div id="tag"></div>
			
			<!-- Shows metadata for the current tag -->
			<div id="tag-metadata"></div>
			
			<!-- Advances to the next tag, or starts the game -->
			<a id="nextButton" href="#" onmouseup="nextButtonClick(); return false;">Next</a>
			
			<!-- The main menu, hidden by default -->
			<div id="mainMenu" class="hidden">
				<!-- Close button for the menu -->
				<div class="menuItem" onclick="menuItemReturnToGameClick();">
					<img id="mainMenuCloseIcon" class="middle" src="images/delete.png" /> Return to game
				</div>
				
				<!-- Holds the score menu items when a game is in progress -->
				<div id="scoreSettings"></div>
				
				<div class="menuHeader">Tags</div>
				<div id="menuItemCategoryIds" class="menuItem" onclick="menuItemCategoryIdsClick();">
					Tag categories: <span class="menuItemValue"></span>
				</div>
				<div id="menuItemDifficulty" class="menuItem">
					Difficulty: <select class="menuItemValue" onchange="menuItemDifficultyChange();"></select>
				</div>
				<div id="menuItemMaxWords" class="menuItem" onclick="menuItemMaxWordsClick();">
					Max words per tag: <span class="menuItemValue"></span>
				</div>
				<div id="menuItemMaxCharacters" class="menuItem" onclick="menuItemMaxCharactersClick();">
					Max characters per tag: <span class="menuItemValue"></span>
				</div>
				<!-- Label instead of div; wraps the checkbox it is "for" so that the whole row is clickable -->
				<label id="menuItemEdgy" class="menuItem" for="menuItemEdgyCheckBox" style="display: block;">
					<input id="menuItemEdgyCheckBox" type="checkbox" class="menuItemValue" onchange="menuItemEdgyChange();" />
					Include adult-themed tags
				</label>
				<!-- Label instead of div; wraps the checkbox it is "for" so that the whole row is clickable -->
				<label id="menuItemShowCategory" class="menuItem" for="menuItemShowCategoryCheckBox" style="display: block;">
					<input id="menuItemShowCategoryCheckBox" type="checkbox" class="menuItemValue" onchange="menuItemShowCategoryChange();" />
					Show the category in-game
				</label>
				<!-- Label instead of div; wraps the checkbox it is "for" so that the whole row is clickable -->
				<label id="menuItemShowAuthor" class="menuItem" for="menuItemShowAuthorCheckBox" style="display: block;">
					<input id="menuItemShowAuthorCheckBox" type="checkbox" class="menuItemValue" onchange="menuItemShowAuthorChange();" />
					Show &quot;submitted by&quot; in-game
				</label>
				
				<div class="menuHeader">Game Rules</div>
				<div id="menuItemWinningPoint" class="menuItem" onclick="menuItemWinningPointClick();">
					<span id="winningPointDescription">Points to win</span>: <span class="menuItemValue"></span>
				</div>
				<div id="menuItemNumberOfTeams" class="menuItem" onclick="menuItemNumberOfTeamsClick();">
					Number of teams: <span class="menuItemValue"></span>
				</div>
				<div id="menuItemMinimumTime" class="menuItem" onclick="menuItemMinimumTimeClick();">
					Least possible game seconds: <span class="menuItemValue"></span>
				</div>
				<div id="menuItemMaximumTime" class="menuItem" onclick="menuItemMaximumTimeClick();">
					Most possible game seconds: <span class="menuItemValue"></span>
				</div>
				
				<div class="menuHeader">Effects</div>
				<div id="menuItemBeepSoundFile" class="menuItem">
					Timer tick: <select class="menuItemValue" onchange="menuItemBeepSoundFileChange();">
						<option value="none">None</option>
						<option value="sounds/beep.wav">Beep</option>
						<option value="sounds/clap.wav">Clap</option>
						<option value="sounds/click.wav">Click</option>
						<option value="sounds/corkpop.wav">Cork pop</option>
						<option value="sounds/echo.wav">Echo</option>
						<option value="sounds/footstep.wav">Footstep</option>
						<option value="sounds/highbeep.wav">High beep</option>
						<option value="sounds/longbeep.wav">Long beep</option>
						<option value="sounds/lowbeep.wav">Low beep</option>
						<option value="sounds/malevoice.wav">Male voice</option>
						<option value="sounds/meow.wav">Meow</option>
						<option value="sounds/orchestra.wav">Orchestra</option>
						<option value="sounds/thump.wav">Thump</option>
						<option value="sounds/tick.wav">Tick</option>
					</select>
				</div>
				<div id="menuItemTheme" class="menuItem">
					Theme: <select class="menuItemValue" onchange="menuItemThemeChange();">
						<option value="style/theme_light.css">Light</option>
						<option value="style/theme_dark.css">Dark</option>
					</select>
				</div>
				<!-- Label instead of div; wraps the checkbox it is "for" so that the whole row is clickable -->
				<label id="menuItemVibrate" class="menuItem" for="menuItemVibrateCheckBox" style="display: block;">
					<input id="menuItemVibrateCheckBox" type="checkbox" class="menuItemValue" onchange="menuItemVibrateChange();" />
					Vibrate
				</label>
				
				<div class="menuHeader">Other</div>
				<div class="menuItem" onclick="menuItemTagCreationClick();">
					Grab Tag Online<br />
					<em>Create your own tags!</em>
				</div>
				<div class="menuItem" onclick="menuItemHelpClick();">Help</div>
				<div class="menuItem" onclick="menuItemAboutClick();">About</div>
			</div>
		</div>
	</body>
</html>